{% extends "__base__.html" %}
{% import "bootstrap/wtf.html" as wtf %}
{% import "_macros.html" as macros %}
{% block title %}{{ super() }} - {{ blog.title }}{% endblock %}
{% block page_content %}
<div class="page-header">
	<h2>{{ blog.title }}</h2>
</div>
<br>
<p>{% if blog.body_html %}{{ blog.body_html | safe }}{% else %}{{ blog.body }}{% endif %}</p>
<br>
<p style="float:left"><i>Published at {{ moment(blog.created_at).format('L') }}</i></p>
<p style="float:right"><i>Last edited at {{ moment(blog.last_edit).fromNow() }}</i></p> 
<hr>
<p><a href="#" class="btn btn-primary btn-sm" id="tags">add tags</a></p>
{% if current_user.is_authenticated %}
<p style="text-align:right">
	<a href="{{ url_for('main.blog_like', id=blog.id) }}" class="btn btn-info btn-sm"><span class="glyphicon glyphicon-thumbs-up"></span> <span class="bagde">{{ blog.liked.count() }}</span></a>
	<a href="{{ url_for('main.blog_dislike', id=blog.id) }}" class="btn btn-info btn-sm"><span class="glyphicon glyphicon-thumbs-down"></span> <span class="bagde">{{ blog.disliked.count() }}</span></a>
	{% if current_user == blog.author %}
	<a href="{{ url_for('main.blog_edit', id=blog.id) }}" class="btn btn-primary btn-sm"><span class="glyphicon glyphicon-edit"></span> Edit</a> 
	<a href="{{ url_for('main.blog_delete', id=blog.id) }}" class="btn btn-danger btn-sm"><span class="glyphicon glyphicon-trash"></span> Delete</a>
	{% endif %}
</p>
{% endif %}
<div class="panel panel-success">
	<div class="panel-heading">
		<h3 class="panel-title">Comments</h3>
	</div>
	<div id="comments" class="panel-body">
		{% set local = url_for('main.blog', id=blog.id)+'#comments' %}
		{% include "_comments.html" %}
		{% if pagination %}
		<div style="text-align:center">
			{{ macros.pagination_widget(pagination, 'main.blog', '#comments', id=blog.id)}}
		</div>
		{% endif %}
	</div>
</div>
<div class="panel panel-primary {% if not current_user.is_authenticated %}disabled{% endif %}">
	<div class="panel-heading">
		<h3 class="panel-title">Make Your Comment</h3>
	</div>
	<div class="panel-body">
		{% if current_user.is_authenticated %}
		{{ wtf.quick_form(form) }}
		{% else %}
		<p class="text-center">Please Sign In</p>
		{% endif %}
	</div>
</div>
{% endblock %}

{% block scripts %}
{{ super() }}
{{ pagedown.include_pagedown() }}
<script type="text/javascript">
$(function(){
	var add_tags = $('#tags');
	add_tags.click(function(e){
		e.preventDefault();
		var new_win = window.open('', '', 'height=400, width=800, top=200, left=500, toolbar=no, menubar=no, scrollbars=no, resizable=no, status=no, location=no');
		new_win.document.write('<html><head><title>New Win</title></head><body><h1></h1></body></html>');
		var body = new_win.document.getElementsByTagName('body')[0];
		var h1 = new_win.document.getElementsByTagName('h1')[0];
		h1.innerText = 'Choose Tags';
		var text_input = new_win.document.createElement('input');
		text_input.setAttribute('type', 'text');
		var btn1 = new_win.document.createElement('button');
		btn1.setAttribute('id', 'btn1');
		btn1.innerText = 'submit';
		body.appendChild(text_input);
		body.appendChild(btn1);
		new_win.document.close();
		$(btn1).click(function(){
			new_win.close();
			alert(text_input.value);
		});
	})
});
</script>
{% endblock %}